<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Najlepsza godzina wyjazdu</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input { width: 300px; padding: 5px; margin: 10px 0; display:block; }
    button { padding: 5px 10px; }
    #results { margin-top: 20px; }
</style>
</head>
<body>

<h2>Planowanie wyjazdu do pracy:</h2>

<input id="startInput" type="text" placeholder="Adres startowy" />
<input id="endInput" type="text" placeholder="Adres docelowy" />
<button id="checkBtn">Sprawdź najlepszą godzinę wyjazdu</button>

<div id="results"></div>

<!-- Google Maps JavaScript API z Places -->
<script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDh1_peFnB-COnDYYkzeXzdGCWVlDMC9w0&libraries=places&callback=initAutocomplete"
    async defer>
</script>

<script>
let autocompleteStart, autocompleteEnd;

function initAutocomplete() {
    const startInput = document.getElementById("startInput");
    const endInput = document.getElementById("endInput");

    autocompleteStart = new google.maps.places.Autocomplete(startInput, {
        types: ["address"],
        componentRestrictions: { country: "pl" }
    });

    autocompleteEnd = new google.maps.places.Autocomplete(endInput, {
        types: ["address"],
        componentRestrictions: { country: "pl" }
    });
}

function displayResult(message) {
    const resultsDiv = document.getElementById("results");
    resultsDiv.innerHTML = `<p>${message}</p>`;
}

// Funkcja do sprawdzenia najlepszej godziny wyjazdu
document.getElementById("checkBtn").addEventListener("click", () => {
    const start = document.getElementById("startInput").value;
    const end = document.getElementById("endInput").value;

    if (!start || !end) {
        alert("Wpisz oba adresy!");
        return;
    }

    const directionsService = new google.maps.DirectionsService();

    // Spróbujemy wybrać najlepszą godzinę w przedziale 7:00-9:00
    const now = new Date();
    let bestTime = null;
    let shortestDuration = Infinity;
    const promises = [];

    for (let hour = 7; hour <= 9; hour++) {
        const departureTime = new Date(now);
        departureTime.setHours(hour, 0, 0, 0);

        promises.push(new Promise((resolve) => {
            directionsService.route({
                origin: start,
                destination: end,
                travelMode: google.maps.TravelMode.DRIVING,
                drivingOptions: {
                    departureTime: departureTime,
                    trafficModel: 'BEST_GUESS'
                }
            }, (result, status) => {
                if (status === "OK") {
                    const durationSec = result.routes[0].legs[0].duration_in_traffic.value;
                    resolve({ hour, durationSec });
                } else {
                    resolve(null);
                }
            });
        }));
    }

    Promise.all(promises).then(results => {
        results.forEach(r => {
            if (r && r.durationSec < shortestDuration) {
                shortestDuration = r.durationSec;
                bestTime = r.hour;
            }
        });

        if (bestTime !== null) {
            const mins = Math.round(shortestDuration / 60);
            displayResult(`Najlepiej wyjechać o godzinie ${bestTime}:00. Szacowany czas przejazdu: ${mins} minut.`);
        } else {
            displayResult("Nie udało się obliczyć czasu przejazdu. Sprawdź adresy.");
        }
    });
});
</script>

</body>
</html>
