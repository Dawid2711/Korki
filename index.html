<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Optymalna trasa z korkami</title>
  <style>
    #map {
      height: 500px;
      width: 100%;
    }
    .controls {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h2>Znajdź najlepszą godzinę wyjazdu z pracy</h2>

  <div class="controls">
    <input id="startInput" type="text" placeholder="Adres startowy" size="50">
    <input id="endInput" type="text" placeholder="Adres docelowy" size="50">
    <button id="routeBtn">Pokaż trasę</button>
  </div>

  <div id="map"></div>

  <script>
    let map, directionsService, directionsRenderer;
    let startAutocomplete, endAutocomplete;

    function initAutocomplete() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 52.2297, lng: 21.0122 }, // Warszawa
        zoom: 12,
      });

      directionsService = new google.maps.DirectionsService();
      directionsRenderer = new google.maps.DirectionsRenderer({ map: map });

      // Nowy standard Autocomplete 2025
      startAutocomplete = new google.maps.places.PlaceAutocompleteElement({
        element: document.getElementById("startInput"),
        fields: ["formatted_address"],
        componentRestrictions: { country: "PL" }
      });

      endAutocomplete = new google.maps.places.PlaceAutocompleteElement({
        element: document.getElementById("endInput"),
        fields: ["formatted_address"],
        componentRestrictions: { country: "PL" }
      });

      document.getElementById("routeBtn").addEventListener("click", () => {
        calculateRoute();
      });
    }

    function calculateRoute() {
      const startPlace = document.getElementById("startInput").value;
      const endPlace = document.getElementById("endInput").value;

      if (!startPlace || !endPlace) {
        alert("Proszę wpisać oba adresy!");
        return;
      }

      // Wyliczenie trasy z uwzględnieniem ruchu drogowego
      directionsService.route(
        {
          origin: startPlace,
          destination: endPlace,
          travelMode: google.maps.TravelMode.DRIVING,
          drivingOptions: {
            departureTime: new Date(), // teraz
            trafficModel: "OPTIMISTIC" // albo PESSIMISTIC
          },
          unitSystem: google.maps.UnitSystem.METRIC
        },
        (result, status) => {
          if (status === "OK" && result) {
            directionsRenderer.setDirections(result);
            const duration = result.routes[0].legs[0].duration_in_traffic.text;
            alert(`Szacowany czas przejazdu z korkami: ${duration}`);
          } else {
            alert("Nie udało się obliczyć trasy: " + status);
          }
        }
      );
    }
  </script>

  <!-- Nowy sposób ładowania API w 2025 -->
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDh1_peFnB-COnDYYkzeXzdGCWVlDMC9w0&libraries=places&callback=initAutocomplete&loading=lazy"
    async defer>
  </script>
</body>
</html>
